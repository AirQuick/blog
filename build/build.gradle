import org.gradle.api.tasks.Exec

String toURI(String path) {
    file(path).toURI().toString()
}

task initDOT {
  String projectDir = "."
  ant.get(src: 'http://mirror.oxygenxml.com/maven-nightly/com/oxygenxml/oxygen-publishing-engine-3.x/22.0-SNAPSHOT/oxygen-publishing-engine-3.x-22.0-SNAPSHOT-package-full.zip', dest: "${projectDir}/dita-ot.zip", skipexisting: 'true')
  ant.unzip(src: "${projectDir}/dita-ot.zip", dest: 'dita-ot')
}

task runTransformation(type:Exec) {
  workingDir "${projectDir}/dita-ot/oxygen-publishing-engine-3.x/bin"

  //on windows:
  commandLine "${projectDir}/dita-ot/oxygen-publishing-engine-3.x/bin/dita.bat", "-f", "html", "-i", "${projectDir}/../oxygen_xml_blog.ditamap", "-o", "${projectDir}/../site"

  //store the output instead of printing to the console:
  standardOutput = new ByteArrayOutputStream()

  //extension method stopTomcat.output() can be used to obtain the output:
  ext.output = {
    return standardOutput.toString()
  }
}

task cleanUp {
   ant.delete(dir: "${projectDir}/dita-ot")
   ant.delete(dir: "${projectDir}/../site")
}

task dist(dependsOn: [initDOT, runTransformation])

defaultTasks 'dist'
