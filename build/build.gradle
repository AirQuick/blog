import org.gradle.api.tasks.Exec

task initDOT {
  String projectDir = "."
  ant.get(src: 'http://mirror.oxygenxml.com/maven-nightly/com/oxygenxml/oxygen-publishing-engine-3.x/22.0-SNAPSHOT/oxygen-publishing-engine-3.x-22.0-SNAPSHOT-package-full.zip', dest: "${projectDir}/dita-ot.zip", skipexisting: 'true')
  ant.unzip(src: "${projectDir}/dita-ot.zip", dest: 'dita-ot')
  new File("${projectDir}/build/dita-ot/oxygen-publishing-engine-3.x/licensekey.txt").write(System.getenv( 'LICENSE_KEY' ).replaceAll("  ", "\n"))
}

task runTransformation(type:Exec) {
  workingDir "${projectDir}/build/dita-ot/oxygen-publishing-engine-3.x/bin"

   commandLine "sh", "${projectDir}/build/dita-ot/oxygen-publishing-engine-3.x/bin/dita", "--project", "${projectDir}/blog-project.xml", "-v"
}

task zCopySite(type: Copy) {
    from "${projectDir}/build/dita-ot/oxygen-publishing-engine-3.x/bin/out/site"
    into "${projectDir}/site"
}

task dist(dependsOn: [initDOT, runTransformation, zCopySite])

defaultTasks 'dist'
